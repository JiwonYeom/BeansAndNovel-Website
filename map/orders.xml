<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org/DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orders">
	
	<!-- 신태  -->
	
<!-- 주문 총 갯수 -->
<select id="selectTotalOrder" parameterType="int" resultType="int">
SELECT count(*)
FROM orders
WHERE user_no=#{userNo}
</select>

<!-- 주문 페이징 리스트 -->
<select id="selectListOrder" parameterType="Order" resultType="Order">
SELECT no,zipcode,address,totalPrice,regdate,invoiceNo,status,userNo
FROM(SELECT no,zipcode,address,totalPrice,regdate,invoiceNo,status,userNo,rownum r
	 FROM(SELECT no,zipcode,address,total_price totalPrice,regdate,invoice_no invoiceNo,status,user_no userNo
		  FROM orders
		  WHERE user_no=#{userNo}
		  ORDER BY no DESC))
WHERE r BETWEEN #{start} AND #{end}		  
</select>	

<!-- 주문번호 검색  -->
<select id="selectOneOrder" parameterType="Order" resultType="Order">
SELECT no,zipcode,address,total_price totalPrice,regdate,invoice_no invoiceNo,status,user_no userNo
FROM orders
WHERE user_no=#{userNo} AND no=#{no}

</select>	
<!-- 신태end  -->
<!-- 해인  -->

	<!-- 주문번호 보여주기 -->
	<select id="selectOrderNumHI" resultType="Order" parameterType="int">
		SELECT no, zipcode, address, total_price totalPrice, regdate, invoice_no invoiceNo, status, user_no userNo
		FROM orders
		WHERE no=#{no}
	</select>
	
	<!-- 주문했을 때 주문번호 추가 -->	
	<insert id="insertOrderHI" parameterType="Order">
		<selectKey order="BEFORE" keyProperty="no" resultType="int">
			SELECT orders_seq.nextval
			FROM dual
		</selectKey>
		INSERT INTO orders(no, zipcode, address, total_price, regdate, invoice_no, status, user_no)
		VALUES (#{no}, #{zipcode}, #{address}, #{totalPrice}, systimestamp, invoice_seq.nextval, 'P', #{userNo})
	</insert>
	<!-- 해인 end -->
	
	<!-- 주영 -->
	
	<!-- order 주문상세정보 -->
	<select id="selectDetailInfoJY" resultType="Order" parameterType="int">
		SELECT no, regdate, status, invoice_no invoiceNo, total_price totalPrice
		FROM orders
		WHERE no=#{no}
	</select>

	<!-- 주문취소 눌렀을 때, 업데이트 -->
	<update id="updateCancelJY" parameterType="int">
		UPDATE orders SET status='C'
		WHERE no=#{no}
	</update>
	
	<!-- 반품신청 눌렀을 때, 업데이트 -->
	<update id="updateRefundJY" parameterType="int">
		UPDATE orders SET status='R'
		WHERE no=#{no}
	</update>
	<!-- 주영end -->
</mapper>